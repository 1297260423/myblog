---
title: "模板匹配"
date: 2023-02-22T15:25:42+08:00
tags: [""]
categories: ["计算机视觉"]
toc:
  enable: true
description: 
draft: true

---

<!--more-->
# 模板匹配的原理

- 模板：待识别目标的标准图像
  - 例如车牌识别中使用的部分模板图像
  - 是一组尺寸、内容固定的图像
- 模板匹配
  - 将模板放在图像上滑动；
  - 没滑动一个像素点，求重合区域的相关度（相似度）；
  - 当相关度最大时，模板下的图像就是待识别的目标。

> 相关度：
> 设：原图像为$f(x,y)$,尺寸为$M*N$。模板图像为$t(i,j)$，$-m\le i \le m$，$-n \le j \le n$。  
> *定义:*  
> $t(i,j)$与$f(x,y)$在$(x,y)$处的相关度$R(x,y)$为：  
> $R(x,y)=\frac{\displaystyle\sum_{i=-m}^m\displaystyle\sum_{j=-n}^nf(x+i,y+j)*t(i,j)}{\sqrt{\displaystyle\sum_{i=-m}^m\displaystyle\sum_{j=-n}^nf(x+i,y+j)^2} \sqrt{\displaystyle\sum_{i=-m}^m\displaystyle\sum_{j=-n}^nt(i,j)^2}}$  
>  相关度的值在0~1.0之间。相关度为1.0表示完全相同。

为消除平均灰度的影响，应先作如下处理：  
从$f(x,y)$中减去平均灰度:   $f(x,y)-F$  
从$t(i,j)$中减去平均灰度:   $t(x,y)-T$
其中，F为模板下面图像的平均灰度；T为模板图像的平均灰度。
于是，相关度公式变为:  
$R(x,y)=\frac{\displaystyle\sum_{i=-m}^m\displaystyle\sum_{j=-n}^n[f(x+i,y+j)]*[t(i,j)]}{\sqrt{\displaystyle\sum_{i=-m}^m\displaystyle\sum_{j=-n}^nf(x+i,y+j)^2} \sqrt{\displaystyle\sum_{i=-m}^m\displaystyle\sum_{j=-n}^n[t(i,j)-T]^2}}$

## 模板匹配识别目标的特点：

1. 与目标的大小、旋转、错切有关。
   解决办法：
   1. 匹配前，先矫正目标的大小、旋转、错切；目标的定位、大小、旋转、错切必须准确。
   2. 准备各种大小、旋转角、错切的模板，一一进行匹配；模板数量极大，实际中难以应用。
2. 具有较强的抗干扰能力。若匹配前目标的大小、旋转、错切矫正良好，则对模糊、污损字符也能较好地识别。 

# 模板匹配方法的改进
问题：模板匹配计算量很大：
- 模板数量多。例如：汽车牌照识别中，有上百个（字符、汉字）；在每一像素位置都要计算一个相关度。
- 解决办法：
  1. SSDA方法——序贯相似性检测法，在求相关度之前，先求模板与图像之间的灰度差：$D(x,y)=\displaystyle\sum_{i=-m}^m\displaystyle\sum_{j=-n}^n|f(x+i,y+j)-t(i,j)|$若$D(x,y)$较大，则该位置不可能是目标。否则，该位置可能是目标，再进一步计算相关度。
  因为差值计算较小，且大部分位置不存在目标，故速度大大提高。
  2. 两步检测法——先粗检测，再精检测。每隔几个像素检测一次，目标一般在相关度较高的位置附近。再在相关度较高的位置附近进行精检测。
  3. 边缘匹配法——应采用边缘型模板。先抽取图像的边缘。在相关计算时，仅考虑边缘点。因边缘点较少，故计算量大大减少。
  4. 局部匹配法——先对模板上的一部分作匹配。当匹配程度较高时，在考虑全部模板匹配。否则放弃。